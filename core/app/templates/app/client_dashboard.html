{% extends 'base.html' %}

{% block title %}–ú–æ–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-5 align-items-center">
        <div class="col-md-8">
            <h2 class="fw-bold display-6">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.first_name|default:user.username }}!</h2>
            <p class="text-muted lead">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–ª–∞—Ç–µ–∂–∞–º–∏.</p>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="p-3 bg-light rounded border">
                <small class="text-muted text-uppercase fw-bold">–í–∞—à –±–∞–ª–∞–Ω—Å</small>
                <div class="fs-4 fw-bold text-dark">0.00 ‚ÇΩ</div>
            </div>
        </div>
    </div>

    {% if contracts %}
        <h4 class="mb-3 text-secondary"><i class="bi bi-collection-fill"></i> –í–∞—à–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</h4>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            {% for contract in contracts %}
            <div class="col">
                <div class="card h-100 shadow-sm border-0 overflow-hidden hover-shadow transition">

                    <div class="position-relative">
                        {% if contract.vehicle.photos.first %}
                            <img src="{{ contract.vehicle.photos.first.image.url }}" class="card-img-top" alt="Auto" style="height: 220px; object-fit: cover;">
                        {% else %}
                            <div class="bg-secondary bg-opacity-10 text-center py-5 text-muted" style="height: 220px;">
                                <i class="bi bi-car-front fs-1 d-block mt-4"></i>
                                <small>–ù–µ—Ç —Ñ–æ—Ç–æ</small>
                            </div>
                        {% endif %}

                        <div class="position-absolute top-0 end-0 m-3">
                            {% if contract.status == 'active' %}
                                <span class="badge bg-success shadow">–î–µ–π—Å—Ç–≤—É–µ—Ç</span>
                            {% elif contract.status == 'completed' %}
                                <span class="badge bg-secondary shadow">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                            {% elif contract.status == 'debt' %}
                                <span class="badge bg-danger shadow animate-pulse">–ï—Å—Ç—å –¥–æ–ª–≥</span>
                            {% elif contract.status == 'terminated' %}
                                <span class="badge bg-dark shadow">–†–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="mb-2">
                            <h5 class="card-title fw-bold mb-0 text-primary">
                                {{ contract.vehicle.brand }} {{ contract.vehicle.model_name }}
                            </h5>
                            <small class="text-muted">{{ contract.vehicle.year }} ‚Ä¢ {{ contract.vehicle.license_plate }}</small>
                        </div>

                        <hr class="my-3">

                        <ul class="list-group list-group-flush small">
                            <li class="list-group-item d-flex justify-content-between px-0 py-2 border-0">
                                <span class="text-muted">–î–æ–≥–æ–≤–æ—Ä ‚Ññ</span>
                                <span class="fw-bold font-monospace">{{ contract.contract_number }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between px-0 py-2 border-0">
                                <span class="text-muted">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂</span>
                                <span class="fw-bold fs-6">{{ contract.monthly_payment }} ‚ÇΩ</span>
                            </li>

                            {% if contract.status == 'active' or contract.status == 'debt' %}
                            <li class="list-group-item d-flex justify-content-between px-0 py-2 border-0">
                                <span class="text-muted">–û–ø–ª–∞—Ç–∏—Ç—å –¥–æ</span>
                                <span class="fw-bold text-danger">
                                    <i class="bi bi-calendar-event"></i> {{ contract.payment_due_day }}-–≥–æ —á–∏—Å–ª–∞
                                </span>
                            </li>
                            {% endif %}
                        </ul>
                    </div>

                    <div class="card-footer bg-white border-top-0 pb-3 pt-0">
                        <a href="{% url 'app:vehicle_detail' contract.vehicle.pk %}" class="btn btn-outline-primary w-100 rounded-pill">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∞–≤—Ç–æ
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5 bg-light rounded-3 border border-dashed">
            <i class="bi bi-emoji-smile fs-1 text-muted d-block mb-3"></i>
            <h4 class="text-dark">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤</h4>
            <p class="text-muted mb-4">–°–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º, —á—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å.</p>
            <a href="#" class="btn btn-primary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥</a>
        </div>
    {% endif %}
</div>

<style>
    /* –ù–µ–±–æ–ª—å—à–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è –∫ –¥–æ–ª–≥–∞–º */
    .animate-pulse {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
        100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }
</style>
{% endblock %}